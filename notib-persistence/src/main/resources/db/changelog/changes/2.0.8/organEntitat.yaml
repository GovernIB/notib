databaseChangeLog:
  - changeSet:
      id: 1634114082437-1
      author: limit
      changes:
        - sql: "
ALTER TABLE NOT_OFICINA DROP CONSTRAINT NOT_OFI_ORGAN_FK;
ALTER TABLE NOT_OFICINA ADD ORGAN_GESTOR NUMBER(19,0);
UPDATE NOT_OFICINA ofi SET ofi.ORGAN_GESTOR = (SELECT id FROM NOT_ORGAN_GESTOR o WHERE ofi.ORGAN_CODI = o.CODI);
ALTER TABLE NOT_OFICINA RENAME COLUMN ORGAN_CODI TO ORGAN_CODI_OLD;
ALTER TABLE NOT_OFICINA ADD CONSTRAINT NOT_OFI_ORGAN_GESTOR_FK FOREIGN KEY (ORGAN_GESTOR) REFERENCES NOT_ORGAN_GESTOR(ID);

ALTER TABLE NOT_NOTIFICACIO DROP CONSTRAINT NOT_NOT_ORGAN_FK;
ALTER TABLE NOT_NOTIFICACIO ADD ORGAN_GESTOR_AUX NUMBER(19,0);
UPDATE NOT_NOTIFICACIO n SET n.ORGAN_GESTOR_AUX = (SELECT id FROM NOT_ORGAN_GESTOR o WHERE n.ORGAN_GESTOR = o.CODI);
ALTER TABLE NOT_NOTIFICACIO RENAME COLUMN ORGAN_GESTOR TO ORGAN_GESTOR_OLD;
ALTER TABLE NOT_NOTIFICACIO ADD CONSTRAINT NOT_ORGAN_GESTOR_FK FOREIGN KEY (ORGAN_GESTOR_AUX) REFERENCES NOT_ORGAN_GESTOR(ID);
ALTER TABLE NOT_NOTIFICACIO RENAME COLUMN ORGAN_GESTOR_AUX TO ORGAN_GESTOR;

ALTER TABLE NOT_ORGAN_GESTOR DROP CONSTRAINT NOT_ORGAN_GESTOR_UK;
DROP INDEX NOT_ORGAN_GESTOR_UK;
ALTER TABLE NOT_ORGAN_GESTOR ADD CONSTRAINT NOT_ORGAN_ENTITAT_UNIQUE UNIQUE (CODI,ENTITAT) ENABLE;

ALTER TABLE NOT_PROCEDIMENT DROP CONSTRAINT NOT_PROC_ORGAN_FK;

ALTER TABLE NOT_PROCEDIMENT ADD ORGAN_GESTOR_AUX NUMBER(19,0);
UPDATE NOT_PROCEDIMENT n SET n.ORGAN_GESTOR_AUX = (SELECT id FROM NOT_ORGAN_GESTOR o WHERE n.ORGAN_GESTOR = o.CODI AND n.ENTITAT = o.ENTITAT);
ALTER TABLE NOT_PROCEDIMENT RENAME COLUMN ORGAN_GESTOR TO ORGAN_GESTOR_OLD;
ALTER TABLE NOT_PROCEDIMENT ADD CONSTRAINT NOT_PROCSER_ORGAN_FK FOREIGN KEY (ORGAN_GESTOR_AUX) REFERENCES NOT_ORGAN_GESTOR(ID);
ALTER TABLE NOT_PROCEDIMENT RENAME COLUMN ORGAN_GESTOR_AUX TO ORGAN_GESTOR;

ALTER TABLE NOT_PROCEDIMENT ADD ORGAN_GESTOR_AUX VARCHAR2(64 CHAR);

UPDATE NOT_PROCEDIMENT n SET n.ORGAN_GESTOR_AUX = (SELECT codi FROM NOT_ORGAN_GESTOR o WHERE n.ORGAN_GESTOR = o.id);

ALTER TABLE NOT_PROCEDIMENT RENAME COLUMN ORGAN_GESTOR_AUX TO ORGAN_CODI;"